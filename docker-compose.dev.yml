services:
  web:
    volumes:
      - ./ui:/app/ui
      - ./database:/app/database
    environment:
      DJANGO_VITE_DEV_MODE: ${DJANGO_VITE_DEV_MODE:-false}
      # DJANGO_VITE_DEV_SERVER_HOST: localhost
      UV_LINK_MODE: copy
      # Place venv outside /app/ui so the host volume mount doesn't shadow it
      UV_PROJECT_ENVIRONMENT: /app/.venv
    command: ["uv", "run", "python", "manage.py", "runserver", "0.0.0.0:8000"]
  # vite-dev:
  # ...
  metadataapi:
    volumes:
      - ./metadataapi:/app/metadataapi
      - ./metadataenricher:/app/metadataenricher
      - ./valuespace-converter:/app/valuespace-converter
      # - .:/app
    environment:
      UV_LINK_MODE: copy
      UV_PROJECT_ENVIRONMENT: /app/.venv
    command: ["uv", "run", "fastapi", "dev", "main.py", "--port", "8081", "--host", "0.0.0.0"]
  scrapyd:
    volumes:
      - ./metadataenricher:/workdir/metadataenricher
      - ./valuespace-converter:/workdir/valuespace-converter
      - ./scraper/edu_sharing_client:/workdir/app/edu_sharing_client