import{j as e,r as u,c as $,R as I}from"./client-DJJ63Tcp.js";/* empty css            */function A(t){const[n,o]=u.useState(!1),[c,l]=u.useState(t.value),g=j=>{j.key==="Enter"?(o(!1),t.onChange(c)):j.key==="Escape"&&(o(!1),l(t.value))};function x(){o(!0),l(t.value)}return e.jsxs("span",{onClick:x,onFocus:x,tabIndex:n?void 0:0,children:[t.value,n?e.jsx("input",{value:c,onChange:j=>l(j.target.value),onKeyDown:g,autoFocus:!0,onBlur:()=>o(!1)}):""]})}function M(t){return e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"URL Pattern"}),e.jsx("th",{children:"Matches"}),e.jsx("th",{children:"New Matches"}),e.jsx("th",{children:"Include"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Position"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:t.rules.map(n=>e.jsxs("tr",{children:[e.jsx(_,{value:n.rule,onChange:o=>t.onUpdateFields(n.id,{rule:o})}),e.jsx("td",{children:n.count}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{style:{flex:1},children:n.cumulative_count}),e.jsx("button",{className:"mybutton mybutton-table",onClick:()=>t.onShowDetails(n.id),children:"ðŸ”"})]})}),e.jsxs("td",{children:[e.jsx("input",{type:"checkbox",checked:n.include,onChange:o=>t.onUpdateFields(n.id,{include:o.target.checked}),id:"include"+n.id}),"Â ",e.jsx("label",{htmlFor:"include"+n.id,children:n.include?"Yes":"No"})]}),e.jsx(_,{value:n.page_type,onChange:o=>t.onUpdateFields(n.id,{page_type:o})}),e.jsx("td",{children:n.position}),e.jsxs("td",{children:[e.jsx("button",{className:"mybutton mybutton-table mybutton-delete",onClick:o=>t.onDelete(n.id),children:"Ã—"}),e.jsx("button",{className:"mybutton mybutton-table",onClick:o=>t.onAdd(n.id),children:"+"}),e.jsx("button",{className:"mybutton mybutton-table",disabled:n.position==1,onClick:o=>t.onMoveUp(n.id),children:"â†‘"}),e.jsx("button",{className:"mybutton mybutton-table",disabled:n.position==t.rules.length,onClick:o=>t.onMoveDown(n.id),children:"â†“"})]})]},n.id))})]})}function _(t){return e.jsx("td",{className:"editable-cell",children:e.jsx(A,{value:t.value,onChange:t.onChange})})}function L(t){const{onClose:n,detailUrls:o}=t;function c(l){l.target==l.currentTarget&&(l.preventDefault(),n())}return e.jsx("div",{className:"mydialog-backdrop",onClick:c,children:e.jsxs("div",{className:"mydialog-window",children:[e.jsxs("div",{className:"mydialog-titlebar",children:[e.jsx("h2",{children:"Details"}),e.jsx("div",{children:e.jsx("button",{className:"mybutton",onClick:n,children:"X"})})]}),e.jsxs("div",{className:"mydialog-content",children:[e.jsx("p",{children:"New URLs matching this rule (and not previous rules):"}),e.jsxs("table",{className:"table table-alternating",children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{children:"URL"})})}),e.jsx("tbody",{children:o.map(l=>e.jsx("tr",{children:e.jsx("td",{children:e.jsx("a",{href:l,children:l})})},l))})]})]})]})})}function O(t){const[n,o]=u.useState(null),[c,l]=u.useState([]),[g,x]=u.useState(!1),[j,C]=u.useState({}),[f,T]=u.useState(null),r=window.location.origin+"/api",y=t.filterSetId;console.log("filterSetId",y);async function w(){const s=r+`/filter_sets/${y}/`,a=await(await fetch(s)).json();console.log(a),o(a),l(a.rules)}u.useEffect(()=>{w(),k()},[]);async function k(){const s=r+`/filter_sets/${y}/unmatched`,a=await(await fetch(s)).json();console.log(a),T(a)}async function D(s){console.log("delete",s);const a=await(await fetch(`${r}/filter_rules/${s}/`,{method:"DELETE",headers:{"X-CSRFToken":t.csrfToken}})).json();console.log(a),l(c.filter(d=>d.id!==s))}async function R(s){console.log("add after",s);const i=r+`/filter_sets/${y}/`;console.log("filterSetUrl",i);const a={filter_set:i,rule:"https://www.weltderphysik.de/wir",count:123,include:!0,page_type:"New row"},d=r+"/filter_rules/",m=await(await fetch(d,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t.csrfToken},body:JSON.stringify(a)})).json();console.log(m),l([...c,m])}async function E(s,i){const a=c.map(h=>h.id===s?{...h,...i}:h);l(a);const d=`${r}/filter_rules/${s}/`,m=await(await fetch(d,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":t.csrfToken},body:JSON.stringify(i)})).json();console.log(m);const b=c.map(h=>h.id===s?m:h);l(b),await w(),await k()}function S(s){return async i=>{var b;const a=`${r}/filter_rules/${i}/`,d=(b=c.find(h=>h.id===i))==null?void 0:b.position;if(d===void 0){console.error("Could not find position of rule with id",i);return}const m=await(await fetch(a,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":t.csrfToken},body:JSON.stringify({position:d+s})})).json();console.log(m),await w()}}async function F(s){console.log("show details",s),C({}),x(!0);const i=`${r}/filter_rules/${s}/matches`,d=await(await fetch(i)).json();console.log(d),C(d)}let p;j.new_matches!==void 0?p=j.new_matches:p=[];let v=0;for(let s=0;s<c.length;s++)c[s].id>v&&(v=c[s].id);return e.jsxs("div",{children:[e.jsxs("p",{children:[n==null?void 0:n.crawl_job.url_count," pages total, ",n==null?void 0:n.remaining_urls," not handled yet"]}),e.jsx("h3",{children:"Rules"}),e.jsx(M,{rules:c,onDelete:D,onAdd:R,onUpdateFields:(s,i)=>{E(s,i)},onMoveUp:S(-1),onMoveDown:S(1),onShowDetails:F}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("button",{className:"mybutton",onClick:()=>R(v),children:"Add rule"}),e.jsx("button",{className:"mybutton mybutton-fancy",children:e.jsx("s",{children:"Suggest rules"})}),e.jsx("div",{style:{flex:1}}),e.jsxs("form",{action:`/filters/${y}/crawl/`,method:"POST",children:[e.jsx("input",{type:"hidden",name:"csrfmiddlewaretoken",value:t.csrfToken}),e.jsx("button",{className:"mybutton",children:"Start content crawl!"})]})]}),g&&e.jsx(L,{onClose:()=>x(!1),detailUrls:p}),e.jsx("h3",{children:"Unmatched URLs"}),f&&e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{children:"URL"})})}),e.jsxs("tbody",{children:[f.unmatched_urls.map(s=>e.jsx("tr",{children:e.jsx("td",{children:s})},s)),!f.is_complete&&e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("i",{children:["+ ",f.total_count-f.unmatched_urls.length," URLs remaining"]})})})]})]})]})}const P=document.getElementById("root"),X=t=>t.replace(/-./g,n=>n[1].toUpperCase()),U=Object.fromEntries(Array.from(P.attributes).filter(t=>t.name.startsWith("data-")).map(t=>[X(t.name.slice(5)),t.value]));console.log("props:",U);$.createRoot(document.getElementById("root")).render(e.jsx(I.StrictMode,{children:e.jsx(O,{...U})}));
